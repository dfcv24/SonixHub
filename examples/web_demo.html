<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SonixHub TTS Web Demo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        input[type="text"], textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        textarea {
            height: 120px;
            resize: vertical;
        }
        
        input[type="range"] {
            width: 100%;
        }
        
        button {
            background-color: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        button:hover {
            background-color: #0056b3;
        }
        
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        .status {
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        
        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background-color: #cce7ff;
            color: #004085;
            border: 1px solid #b8daff;
        }
        
        .audio-controls {
            margin-top: 20px;
            text-align: center;
        }
        
        audio {
            width: 100%;
            margin-top: 10px;
        }
        
        .parameter-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .parameter-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .parameter-item label {
            margin-bottom: 0;
            margin-right: 10px;
        }
        
        .parameter-value {
            font-weight: bold;
            color: #007bff;
            min-width: 40px;
            text-align: right;
        }
        
        .file-upload {
            position: relative;
            display: inline-block;
            cursor: pointer;
            width: 100%;
        }
        
        .file-upload input[type="file"] {
            position: absolute;
            left: -9999px;
        }
        
        .file-upload-label {
            display: block;
            padding: 10px;
            background-color: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-upload-label:hover {
            border-color: #007bff;
            background-color: #e7f3ff;
        }
        
        .examples {
            margin-top: 30px;
        }
        
        .example-item {
            background-color: #f8f9fa;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .example-item:hover {
            background-color: #e9ecef;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ™ï¸ SonixHub TTS Web Demo</h1>
        
        <div class="form-group">
            <label for="serverUrl">æœåŠ¡å™¨åœ°å€:</label>
            <input type="text" id="serverUrl" value="http://localhost:8000" placeholder="http://localhost:8000">
        </div>
        
        <div class="form-group">
            <label for="inputText">è¦åˆæˆçš„æ–‡æœ¬:</label>
            <textarea id="inputText" placeholder="è¯·è¾“å…¥è¦åˆæˆçš„æ–‡æœ¬...">ä½ å¥½ï¼Œæ¬¢è¿ä½¿ç”¨SonixHubè¯­éŸ³åˆæˆæœåŠ¡ï¼</textarea>
        </div>
        
        <div class="form-group">
            <label for="textLanguage">æ–‡æœ¬è¯­è¨€:</label>
            <select id="textLanguage">
                <option value="zh">ä¸­æ–‡</option>
                <option value="en">è‹±æ–‡</option>
                <option value="ja">æ—¥æ–‡</option>
                <option value="auto">è‡ªåŠ¨è¯†åˆ«</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="referenceAudio">å‚è€ƒéŸ³é¢‘æ–‡ä»¶ (å¯é€‰):</label>
            <div class="file-upload">
                <input type="file" id="referenceAudio" accept="audio/*">
                <label for="referenceAudio" class="file-upload-label">
                    <span id="fileUploadText">ç‚¹å‡»é€‰æ‹©éŸ³é¢‘æ–‡ä»¶æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</span>
                </label>
            </div>
        </div>
        
        <div class="form-group">
            <label for="promptText">å‚è€ƒéŸ³é¢‘å¯¹åº”æ–‡æœ¬:</label>
            <input type="text" id="promptText" placeholder="å‚è€ƒéŸ³é¢‘å¯¹åº”çš„æ–‡å­—å†…å®¹">
        </div>
        
        <div class="parameter-group">
            <div class="parameter-item">
                <label for="temperature">Temperature:</label>
                <input type="range" id="temperature" min="0.1" max="1.5" step="0.1" value="0.6">
                <span class="parameter-value" id="temperatureValue">0.6</span>
            </div>
            
            <div class="parameter-item">
                <label for="speed">è¯­é€Ÿ:</label>
                <input type="range" id="speed" min="0.5" max="2.0" step="0.1" value="1.0">
                <span class="parameter-value" id="speedValue">1.0</span>
            </div>
            
            <div class="parameter-item">
                <label for="topK">Top K:</label>
                <input type="range" id="topK" min="1" max="100" step="1" value="20">
                <span class="parameter-value" id="topKValue">20</span>
            </div>
            
            <div class="parameter-item">
                <label for="topP">Top P:</label>
                <input type="range" id="topP" min="0.1" max="1.0" step="0.1" value="0.6">
                <span class="parameter-value" id="topPValue">0.6</span>
            </div>
        </div>
        
        <div class="form-group">
            <button id="synthesizeBtn" onclick="synthesizeText()">ğŸµ åˆæˆè¯­éŸ³</button>
            <button id="checkStatusBtn" onclick="checkStatus()">ğŸ“Š æ£€æŸ¥çŠ¶æ€</button>
            <button id="getLanguagesBtn" onclick="getLanguages()">ğŸŒ è·å–è¯­è¨€</button>
        </div>
        
        <div id="status" class="status"></div>
        
        <div class="audio-controls">
            <audio id="audioPlayer" controls style="display: none;"></audio>
        </div>
        
        <div class="examples">
            <h3>ç¤ºä¾‹æ–‡æœ¬:</h3>
            <div class="example-item" onclick="setExampleText('ä½ å¥½ï¼Œæ¬¢è¿ä½¿ç”¨SonixHubè¯­éŸ³åˆæˆæœåŠ¡ï¼è¿™æ˜¯ä¸€ä¸ªåŸºäºGPT-SoVITSçš„é«˜è´¨é‡è¯­éŸ³åˆæˆç³»ç»Ÿã€‚')">
                ä¸­æ–‡ç¤ºä¾‹ï¼šæ¬¢è¿ä½¿ç”¨è¯­éŸ³åˆæˆæœåŠ¡
            </div>
            <div class="example-item" onclick="setExampleText('Hello, welcome to SonixHub TTS service! This is a high-quality text-to-speech system based on GPT-SoVITS.')">
                è‹±æ–‡ç¤ºä¾‹ï¼šWelcome to TTS service
            </div>
            <div class="example-item" onclick="setExampleText('ä»Šå¤©å¤©æ°”çœŸä¸é”™ï¼Œé˜³å…‰æ˜åªšï¼Œå¾®é£å¾æ¥ã€‚æ­£æ˜¯å‡ºé—¨æ•£æ­¥çš„å¥½æ—¶å…‰ï¼Œè®©æˆ‘ä»¬ä¸€èµ·äº«å—è¿™ç¾å¥½çš„åˆåæ—¶å…‰å§ï¼')">
                ä¸­æ–‡ç¤ºä¾‹ï¼šå¤©æ°”æè¿°
            </div>
            <div class="example-item" onclick="setExampleText('äººå·¥æ™ºèƒ½æŠ€æœ¯çš„å‘å±•ä¸ºæˆ‘ä»¬å¸¦æ¥äº†è®¸å¤šä¾¿åˆ©ï¼Œè¯­éŸ³åˆæˆæŠ€æœ¯å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚å®ƒèƒ½å¤Ÿå°†æ–‡å­—è½¬æ¢ä¸ºè‡ªç„¶æµç•…çš„è¯­éŸ³ï¼Œå¸®åŠ©äººä»¬æ›´å¥½åœ°è·å–ä¿¡æ¯ã€‚')">
                ä¸­æ–‡ç¤ºä¾‹ï¼šæŠ€æœ¯ä»‹ç»
            </div>
        </div>
    </div>

    <script>
        // æ›´æ–°å‚æ•°å€¼æ˜¾ç¤º
        function updateParameterValues() {
            document.getElementById('temperatureValue').textContent = document.getElementById('temperature').value;
            document.getElementById('speedValue').textContent = document.getElementById('speed').value;
            document.getElementById('topKValue').textContent = document.getElementById('topK').value;
            document.getElementById('topPValue').textContent = document.getElementById('topP').value;
        }
        
        // ç»‘å®šå‚æ•°æ»‘å—äº‹ä»¶
        document.getElementById('temperature').addEventListener('input', updateParameterValues);
        document.getElementById('speed').addEventListener('input', updateParameterValues);
        document.getElementById('topK').addEventListener('input', updateParameterValues);
        document.getElementById('topP').addEventListener('input', updateParameterValues);
        
        // æ–‡ä»¶ä¸Šä¼ å¤„ç†
        document.getElementById('referenceAudio').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                document.getElementById('fileUploadText').textContent = file.name;
            } else {
                document.getElementById('fileUploadText').textContent = 'ç‚¹å‡»é€‰æ‹©éŸ³é¢‘æ–‡ä»¶æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„';
            }
        });
        
        // æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 3000);
        }
        
        // è®¾ç½®ç¤ºä¾‹æ–‡æœ¬
        function setExampleText(text) {
            document.getElementById('inputText').value = text;
            
            // æ ¹æ®æ–‡æœ¬å†…å®¹è‡ªåŠ¨è®¾ç½®è¯­è¨€
            const hasChineseChar = /[\u4e00-\u9fa5]/.test(text);
            const hasEnglishChar = /[a-zA-Z]/.test(text);
            
            if (hasChineseChar && hasEnglishChar) {
                document.getElementById('textLanguage').value = 'zh';
            } else if (hasChineseChar) {
                document.getElementById('textLanguage').value = 'zh';
            } else if (hasEnglishChar) {
                document.getElementById('textLanguage').value = 'en';
            }
        }
        
        // æ£€æŸ¥æœåŠ¡çŠ¶æ€
        async function checkStatus() {
            const serverUrl = document.getElementById('serverUrl').value;
            showStatus('æ­£åœ¨æ£€æŸ¥æœåŠ¡çŠ¶æ€...', 'info');
            
            try {
                const response = await fetch(`${serverUrl}/status`);
                const data = await response.json();
                
                if (response.ok) {
                    showStatus(`æœåŠ¡çŠ¶æ€: ${data.status}, æ¨¡å‹ç‰ˆæœ¬: ${data.model_version}, è®¾å¤‡: ${data.device}`, 'success');
                } else {
                    showStatus('æœåŠ¡çŠ¶æ€æ£€æŸ¥å¤±è´¥', 'error');
                }
            } catch (error) {
                showStatus(`è¿æ¥æœåŠ¡å™¨å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // è·å–æ”¯æŒçš„è¯­è¨€
        async function getLanguages() {
            const serverUrl = document.getElementById('serverUrl').value;
            showStatus('æ­£åœ¨è·å–è¯­è¨€åˆ—è¡¨...', 'info');
            
            try {
                const response = await fetch(`${serverUrl}/languages`);
                const data = await response.json();
                
                if (response.ok) {
                    const languages = data.language_codes.join(', ');
                    showStatus(`æ”¯æŒçš„è¯­è¨€: ${languages}`, 'success');
                } else {
                    showStatus('è·å–è¯­è¨€åˆ—è¡¨å¤±è´¥', 'error');
                }
            } catch (error) {
                showStatus(`è¿æ¥æœåŠ¡å™¨å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // è¯­éŸ³åˆæˆ
        async function synthesizeText() {
            const serverUrl = document.getElementById('serverUrl').value;
            const text = document.getElementById('inputText').value.trim();
            
            if (!text) {
                showStatus('è¯·è¾“å…¥è¦åˆæˆçš„æ–‡æœ¬', 'error');
                return;
            }
            
            const synthesizeBtn = document.getElementById('synthesizeBtn');
            synthesizeBtn.disabled = true;
            synthesizeBtn.textContent = 'æ­£åœ¨åˆæˆ...';
            
            showStatus('æ­£åœ¨åˆæˆè¯­éŸ³ï¼Œè¯·ç¨å€™...', 'info');
            
            try {
                const referenceAudio = document.getElementById('referenceAudio').files[0];
                
                if (referenceAudio) {
                    // ä½¿ç”¨ä¸Šä¼ çš„å‚è€ƒéŸ³é¢‘
                    await synthesizeWithUpload(serverUrl, text, referenceAudio);
                } else {
                    // ä½¿ç”¨é»˜è®¤å‚è€ƒéŸ³é¢‘
                    await synthesizeWithDefault(serverUrl, text);
                }
                
            } catch (error) {
                showStatus(`åˆæˆå¤±è´¥: ${error.message}`, 'error');
            } finally {
                synthesizeBtn.disabled = false;
                synthesizeBtn.textContent = 'ğŸµ åˆæˆè¯­éŸ³';
            }
        }
        
        // ä½¿ç”¨é»˜è®¤å‚è€ƒéŸ³é¢‘åˆæˆ
        async function synthesizeWithDefault(serverUrl, text) {
            const payload = {
                text: text,
                text_language: document.getElementById('textLanguage').value,
                temperature: parseFloat(document.getElementById('temperature').value),
                speed: parseFloat(document.getElementById('speed').value),
                top_k: parseInt(document.getElementById('topK').value),
                top_p: parseFloat(document.getElementById('topP').value)
            };
            
            const promptText = document.getElementById('promptText').value.trim();
            if (promptText) {
                payload.prompt_text = promptText;
            }
            
            const response = await fetch(`${serverUrl}/tts`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload)
            });
            
            if (response.ok) {
                const audioBlob = await response.blob();
                playAudio(audioBlob);
                showStatus('è¯­éŸ³åˆæˆæˆåŠŸï¼', 'success');
            } else {
                const errorText = await response.text();
                throw new Error(`HTTP ${response.status}: ${errorText}`);
            }
        }
        
        // ä½¿ç”¨ä¸Šä¼ çš„å‚è€ƒéŸ³é¢‘åˆæˆ
        async function synthesizeWithUpload(serverUrl, text, referenceAudio) {
            const formData = new FormData();
            formData.append('text', text);
            formData.append('text_language', document.getElementById('textLanguage').value);
            formData.append('refer_audio', referenceAudio);
            formData.append('temperature', document.getElementById('temperature').value);
            formData.append('speed', document.getElementById('speed').value);
            formData.append('top_k', document.getElementById('topK').value);
            formData.append('top_p', document.getElementById('topP').value);
            
            const promptText = document.getElementById('promptText').value.trim();
            if (promptText) {
                formData.append('prompt_text', promptText);
                formData.append('prompt_language', document.getElementById('textLanguage').value);
            }
            
            const response = await fetch(`${serverUrl}/tts/upload`, {
                method: 'POST',
                body: formData
            });
            
            if (response.ok) {
                const audioBlob = await response.blob();
                playAudio(audioBlob);
                showStatus('è¯­éŸ³åˆæˆæˆåŠŸï¼', 'success');
            } else {
                const errorText = await response.text();
                throw new Error(`HTTP ${response.status}: ${errorText}`);
            }
        }
        
        // æ’­æ”¾éŸ³é¢‘
        function playAudio(audioBlob) {
            const audioPlayer = document.getElementById('audioPlayer');
            const audioUrl = URL.createObjectURL(audioBlob);
            
            audioPlayer.src = audioUrl;
            audioPlayer.style.display = 'block';
            audioPlayer.play();
            
            // æ·»åŠ ä¸‹è½½é“¾æ¥
            const downloadLink = document.createElement('a');
            downloadLink.href = audioUrl;
            downloadLink.download = 'synthesized_speech.wav';
            downloadLink.textContent = 'ä¸‹è½½éŸ³é¢‘';
            downloadLink.style.marginLeft = '10px';
            
            const audioControls = document.querySelector('.audio-controls');
            const existingLink = audioControls.querySelector('a');
            if (existingLink) {
                existingLink.remove();
            }
            audioControls.appendChild(downloadLink);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåæ£€æŸ¥æœåŠ¡çŠ¶æ€
        window.addEventListener('load', function() {
            checkStatus();
        });
    </script>
</body>
</html>
